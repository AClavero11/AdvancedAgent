<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Reset Password&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: Arial, sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f5f5f7;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.container {</p>
<p class="p1"><span class="Apple-converted-space">            </span>max-width: 450px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 50px auto;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 8px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 25px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>h2 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #333;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.form-group {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 20px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>label {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: block;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: bold;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 8px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>input {</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 12px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #ddd;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 4px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-sizing: border-box;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 16px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>button {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #0d6efd;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 12px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 4px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 16px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>button:disabled {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #6c757d;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: not-allowed;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.message {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 12px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 15px 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 4px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.error {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f8d7da;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #dc3545;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.success {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #d4edda;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #28a745;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.back-link {</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 15px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.back-link a {</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #6c757d;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-decoration: none;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="container" id="step1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h2&gt;Reset Your Password&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label for="email"&gt;Email Address&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;input type="email" id="email" placeholder="Your email address"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="sendCodeBtn"&gt;Send Reset Code&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="step1Message" class="message" style="display: none;"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="back-link"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;a href="index.html"&gt;Back to Login&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="container" id="step2" style="display: none;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h2&gt;Enter Reset Code&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label for="code"&gt;Reset Code&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;input type="text" id="code" placeholder="Code from your email"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label for="newPassword"&gt;New Password&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;input type="password" id="newPassword" placeholder="New password"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label for="confirmPassword"&gt;Confirm Password&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;input type="password" id="confirmPassword" placeholder="Confirm new password"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="resetPasswordBtn"&gt;Reset Password&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="step2Message" class="message" style="display: none;"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="back-link"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;a href="#" id="backToStep1"&gt;Back&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>// First, let's try a different way to access the API</p>
<p class="p1"><span class="Apple-converted-space">        </span>const API_BASE = "https://c9z46e3pgg.execute-api.us-east-2.amazonaws.com";</p>
<p class="p1"><span class="Apple-converted-space">        </span>const API_PATH = "/prod/aac-api";</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Elements</p>
<p class="p1"><span class="Apple-converted-space">        </span>const step1 = document.getElementById('step1');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const step2 = document.getElementById('step2');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const sendCodeBtn = document.getElementById('sendCodeBtn');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const resetPasswordBtn = document.getElementById('resetPasswordBtn');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const step1Message = document.getElementById('step1Message');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const step2Message = document.getElementById('step2Message');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const backToStep1 = document.getElementById('backToStep1');</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Display message function</p>
<p class="p1"><span class="Apple-converted-space">        </span>function showMessage(element, message, isError) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>element.textContent = message;</p>
<p class="p1"><span class="Apple-converted-space">            </span>element.className = isError ? 'message error' : 'message success';</p>
<p class="p1"><span class="Apple-converted-space">            </span>element.style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Test API connectivity directly</p>
<p class="p1"><span class="Apple-converted-space">        </span>console.log("Testing API connectivity...");</p>
<p class="p1"><span class="Apple-converted-space">        </span>fetch(API_BASE + API_PATH, {</p>
<p class="p1"><span class="Apple-converted-space">            </span>method: 'POST',</p>
<p class="p1"><span class="Apple-converted-space">            </span>headers: { 'Content-Type': 'application/json' },</p>
<p class="p1"><span class="Apple-converted-space">            </span>body: JSON.stringify({ requestType: 'ping' })</p>
<p class="p1"><span class="Apple-converted-space">        </span>})</p>
<p class="p1"><span class="Apple-converted-space">        </span>.then(response =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>console.log("API ping response status:", response.status);</p>
<p class="p1"><span class="Apple-converted-space">            </span>return response.text();</p>
<p class="p1"><span class="Apple-converted-space">        </span>})</p>
<p class="p1"><span class="Apple-converted-space">        </span>.then(text =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>console.log("API ping response:", text);</p>
<p class="p1"><span class="Apple-converted-space">        </span>})</p>
<p class="p1"><span class="Apple-converted-space">        </span>.catch(error =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>console.error("API connectivity test failed:", error);</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Send code button click</p>
<p class="p1"><span class="Apple-converted-space">        </span>sendCodeBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const email = document.getElementById('email').value.trim();</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!email) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage(step1Message, "Please enter your email address", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Disable button and show loading</p>
<p class="p1"><span class="Apple-converted-space">            </span>sendCodeBtn.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">            </span>sendCodeBtn.textContent = "Sending...";</p>
<p class="p1"><span class="Apple-converted-space">            </span>showMessage(step1Message, "Sending reset code...", false);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Try a different way to call the API with a timeout</p>
<p class="p1"><span class="Apple-converted-space">            </span>const controller = new AbortController();</p>
<p class="p1"><span class="Apple-converted-space">            </span>const timeoutId = setTimeout(() =&gt; controller.abort(), 10000); // 10 second timeout</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>fetch(API_BASE + API_PATH, {</p>
<p class="p1"><span class="Apple-converted-space">                </span>method: 'POST',</p>
<p class="p1"><span class="Apple-converted-space">                </span>signal: controller.signal,</p>
<p class="p1"><span class="Apple-converted-space">                </span>headers: { 'Content-Type': 'application/json' },</p>
<p class="p1"><span class="Apple-converted-space">                </span>body: JSON.stringify({</p>
<p class="p1"><span class="Apple-converted-space">                    </span>requestType: 'auth',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>authAction: 'forgotPassword',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>email: email</p>
<p class="p1"><span class="Apple-converted-space">                </span>})</p>
<p class="p1"><span class="Apple-converted-space">            </span>})</p>
<p class="p1"><span class="Apple-converted-space">            </span>.then(response =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>clearTimeout(timeoutId);</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.log("API response status:", response.status);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return response.json();</p>
<p class="p1"><span class="Apple-converted-space">            </span>})</p>
<p class="p1"><span class="Apple-converted-space">            </span>.then(data =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.log("API response:", data);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Reset button</p>
<p class="p1"><span class="Apple-converted-space">                </span>sendCodeBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>sendCodeBtn.textContent = "Send Reset Code";</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (data.error) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showMessage(step1Message, data.error, true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showMessage(step1Message, "Reset code sent! Check your email.", false);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Store email for step 2</p>
<p class="p1"><span class="Apple-converted-space">                    </span>localStorage.setItem('resetEmail', email);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Show step 2 after delay</p>
<p class="p1"><span class="Apple-converted-space">                    </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>step1.style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>step2.style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}, 1500);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>})</p>
<p class="p1"><span class="Apple-converted-space">            </span>.catch(error =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>clearTimeout(timeoutId);</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("API call failed:", error);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Reset button</p>
<p class="p1"><span class="Apple-converted-space">                </span>sendCodeBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>sendCodeBtn.textContent = "Send Reset Code";</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Try to make a simple AJAX request as fallback</p>
<p class="p1"><span class="Apple-converted-space">                </span>const xhr = new XMLHttpRequest();</p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.open('POST', API_BASE + API_PATH, true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.setRequestHeader('Content-Type', 'application/json');</p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.timeout = 10000; // 10 second timeout</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.onload = function() {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.log("XHR status:", xhr.status);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.log("XHR response:", xhr.responseText);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const data = JSON.parse(xhr.responseText);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (data.error) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>showMessage(step1Message, data.error, true);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>showMessage(step1Message, "Reset code sent! Check your email.", false);</p>
<p class="p2"><span class="Apple-converted-space">                            </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>// Store email for step 2</p>
<p class="p1"><span class="Apple-converted-space">                            </span>localStorage.setItem('resetEmail', email);</p>
<p class="p2"><span class="Apple-converted-space">                            </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>// Show step 2 after delay</p>
<p class="p1"><span class="Apple-converted-space">                            </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>step1.style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">                                </span>step2.style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}, 1500);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>showMessage(step1Message, "Network error. Please check your connection and try again.", true);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.onerror = function() {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error("XHR error");</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showMessage(step1Message, "Network error. Please check your connection and try again.", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.ontimeout = function() {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error("XHR timeout");</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showMessage(step1Message, "Request timed out. Please try again.", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.send(JSON.stringify({</p>
<p class="p1"><span class="Apple-converted-space">                    </span>requestType: 'auth',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>authAction: 'forgotPassword',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>email: email</p>
<p class="p1"><span class="Apple-converted-space">                </span>}));</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Reset password button click</p>
<p class="p1"><span class="Apple-converted-space">        </span>resetPasswordBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const code = document.getElementById('code').value.trim();</p>
<p class="p1"><span class="Apple-converted-space">            </span>const newPassword = document.getElementById('newPassword').value;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const confirmPassword = document.getElementById('confirmPassword').value;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const email = localStorage.getItem('resetEmail');</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Validation</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!code) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage(step2Message, "Please enter the verification code", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!newPassword) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage(step2Message, "Please enter a new password", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (newPassword !== confirmPassword) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage(step2Message, "Passwords do not match", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!email) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage(step2Message, "Email information missing. Please start over.", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Disable button and show loading</p>
<p class="p1"><span class="Apple-converted-space">            </span>resetPasswordBtn.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">            </span>resetPasswordBtn.textContent = "Resetting...";</p>
<p class="p1"><span class="Apple-converted-space">            </span>showMessage(step2Message, "Resetting password...", false);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Try multiple methods to call the API</p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// Method 1: Fetch with timeout</p>
<p class="p1"><span class="Apple-converted-space">                </span>const controller = new AbortController();</p>
<p class="p1"><span class="Apple-converted-space">                </span>const timeoutId = setTimeout(() =&gt; controller.abort(), 10000);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>fetch(API_BASE + API_PATH, {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>method: 'POST',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>signal: controller.signal,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>headers: { 'Content-Type': 'application/json' },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>body: JSON.stringify({</p>
<p class="p1"><span class="Apple-converted-space">                        </span>requestType: 'auth',</p>
<p class="p1"><span class="Apple-converted-space">                        </span>authAction: 'confirmForgotPassword',</p>
<p class="p1"><span class="Apple-converted-space">                        </span>email: email,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>code: code,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>newPassword: newPassword</p>
<p class="p1"><span class="Apple-converted-space">                    </span>})</p>
<p class="p1"><span class="Apple-converted-space">                </span>})</p>
<p class="p1"><span class="Apple-converted-space">                </span>.then(response =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>clearTimeout(timeoutId);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.log("API response status:", response.status);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return response.json();</p>
<p class="p1"><span class="Apple-converted-space">                </span>})</p>
<p class="p1"><span class="Apple-converted-space">                </span>.then(data =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.log("API response:", data);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Reset button</p>
<p class="p1"><span class="Apple-converted-space">                    </span>resetPasswordBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>resetPasswordBtn.textContent = "Reset Password";</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (data.error) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>showMessage(step2Message, data.error, true);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>showMessage(step2Message, "Password reset successful!", false);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>localStorage.removeItem('resetEmail');</p>
<p class="p2"><span class="Apple-converted-space">                        </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>// Redirect to login after delay</p>
<p class="p1"><span class="Apple-converted-space">                        </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>window.location.href = "index.html";</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}, 1500);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>})</p>
<p class="p1"><span class="Apple-converted-space">                </span>.catch(error =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>clearTimeout(timeoutId);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error("API call failed:", error);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>resetPasswordBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>resetPasswordBtn.textContent = "Reset Password";</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showMessage(step2Message, "Network error. Please try again.", true);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Try fallback method</p>
<p class="p1"><span class="Apple-converted-space">                    </span>useXhrFallback();</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Fetch setup failed:", e);</p>
<p class="p1"><span class="Apple-converted-space">                </span>useXhrFallback();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>function useXhrFallback() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.log("Using XHR fallback");</p>
<p class="p1"><span class="Apple-converted-space">                </span>const xhr = new XMLHttpRequest();</p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.open('POST', API_BASE + API_PATH, true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.setRequestHeader('Content-Type', 'application/json');</p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.timeout = 10000;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.onload = function() {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.log("XHR status:", xhr.status);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.log("XHR response:", xhr.responseText);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>resetPasswordBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>resetPasswordBtn.textContent = "Reset Password";</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const data = JSON.parse(xhr.responseText);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (data.error) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>showMessage(step2Message, data.error, true);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>showMessage(step2Message, "Password reset successful!", false);</p>
<p class="p1"><span class="Apple-converted-space">                            </span>localStorage.removeItem('resetEmail');</p>
<p class="p2"><span class="Apple-converted-space">                            </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>window.location.href = "index.html";</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}, 1500);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>showMessage(step2Message, "Error processing response. Please try again.", true);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.onerror = function() {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>resetPasswordBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>resetPasswordBtn.textContent = "Reset Password";</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showMessage(step2Message, "Network error. Please try again.", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.ontimeout = function() {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>resetPasswordBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>resetPasswordBtn.textContent = "Reset Password";</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showMessage(step2Message, "Request timed out. Please try again.", true);</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>xhr.send(JSON.stringify({</p>
<p class="p1"><span class="Apple-converted-space">                    </span>requestType: 'auth',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>authAction: 'confirmForgotPassword',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>email: email,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>code: code,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>newPassword: newPassword</p>
<p class="p1"><span class="Apple-converted-space">                </span>}));</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Back button</p>
<p class="p1"><span class="Apple-converted-space">        </span>backToStep1.addEventListener('click', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">            </span>step2.style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">            </span>step1.style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
